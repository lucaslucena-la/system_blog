{% extends "base.html" %}

{% block extra_css %}
    <link rel="stylesheet" href="{{ url_for('static', filename='css/admin_users.css') }}">
{% endblock %}


{% block content %}
    <div class="container">
        <h1 class="border-bottom mb-4 pb-2">Administração de Usuários</h1>
        
        <div class="content-section">
            <p class="text-muted mb-4">Você está visualizando todos os usuários do sistema. Apenas Administradores podem alterar os papéis.</p>
            
            <table class="table-users">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Nome de Usuário</th>
                        <th>Email</th>
                        <th>Papel Atual</th>
                        <th>Ativo</th>
                        <th>Ações</th>
                    </tr>
                </thead>
                <tbody>
                    {% for user_item in users %}
                    <tr>
                        <td data-label="ID">{{ user_item.id }}</td>
                        <td data-label="Nome">{{ user_item.username }}</td>
                        <td data-label="Email">{{ user_item.email }}</td>
                        <td data-label="Papel"><strong>{{ user_item.role.name }}</strong></td>
                        <td data-label="Ativo">{{ 'Sim' if user_item.is_active else 'Não' }}</td>
                        <td data-label="Ações">
                            <!-- Formulário para alterar o papel de um usuário -->
                            <form method="POST" action="{{ url_for('admin_user_role_update', user_id=user_item.id) }}" class="role-form">

                                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">

                                {% set form = AdminUserRoleForm() %}
                                
                                <select name="{{ form.role_id.name }}" class="form-control-select">
                                    {% for id, name in role_choices %}
                                        <option value="{{ id }}" {% if id == user_item.role_id %}selected{% endif %}>
                                            {{ name }}
                                        </option>
                                    {% endfor %}
                                </select>
                                
                                <!-- O admin não pode mudar o próprio papel -->
                                {% if user_item.id != current_user.id %}
                                    <input type="submit" value="Alterar" class="btn btn-primary btn-sm ml-2">
                                {% else %}
                                    <span class="text-muted ml-2">(Seu Papel)</span>
                                {% endif %}
                            </form>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
{% endblock content %}
